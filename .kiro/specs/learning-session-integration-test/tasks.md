# 학습 세션 통합 테스트 구현 계획

- [x] 1. 테스트 환경 설정 및 기본 구조 생성

  - backend/tests/0820/ 폴더 구조 생성
  - conftest.py 파일에 기본 픽스처 설정
  - 테스트용 Flask 앱 및 클라이언트 설정
  - _요구사항: 1.1, 1.2_

- [x] 2. 테스트 데이터 관리 클래스 구현

  - TestDataManager 클래스 생성
  - test_ 접두사를 가진 사용자 생성 기능
  - 생성된 테스트 데이터 로깅 기능
  - 수동 삭제를 위한 데이터 요약 조회 기능
  - _요구사항: 3.1, 3.2, 4.1_

- [x] 3. 데이터베이스 검증 헬퍼 클래스 구현

  - DatabaseVerifier 클래스 생성
  - learning_sessions 테이블 저장 검증 메서드
  - session_conversations 테이블 저장 검증 메서드
  - session_quizzes 테이블 저장 검증 메서드
  - user_statistics 테이블 업데이트 검증 메서드
  - _요구사항: 3.1, 3.2, 3.3, 3.4_

- [x] 4. 인증 및 사용자 관련 픽스처 구현





  - 테스트 사용자 생성 픽스처
  - JWT 토큰 생성 및 인증 헤더 픽스처
  - 사용자 진행 상태 초기화 픽스처
  - 세션 상태 초기화 픽스처
  - _요구사항: 1.1, 2.2, 4.2_

- [x] 5. 학습 세션 시작 API 테스트 구현





  - 정상적인 세션 시작 테스트
  - 유효하지 않은 토큰으로 세션 시작 테스트
  - 접근 권한 없는 챕터/섹션 접근 테스트
  - 진단 미완료 사용자 접근 테스트
  - _요구사항: 1.1, 2.2, 2.3_

- [x] 5.1. 세션 서비스 오류 디버깅 및 수정
  - 'tuple' object has no attribute 'get' 오류 원인 분석
  - 세션 서비스 내부 로직 검증 및 수정
  - 권한 검증 로직 구현 확인
  - 정상적인 세션 시작 플로우 복구
  - _요구사항: 1.1, 2.3_

- [x] 5.2. API 문서 표준 형식 적용 및 테스트 수정







  - 세션 서비스 응답 형식을 API 문서 표준에 맞게 수정
  - 테스트 검증 로직을 API 문서 표준 형식에 맞게 업데이트
  - 세션 매니저 단독 테스트 파일 생성 및 실행
  - 최종 통합 테스트 실행 및 검증
  - _요구사항: 1.1, 2.1, 2.4_

- [x] 6. 메시지 처리 API 테스트 구현





  - 이론 설명 후 "다음 단계" 메시지 처리 테스트
  - 질문 메시지 처리 및 QnA 에이전트 응답 테스트
  - 활성 세션 없이 메시지 전송 테스트
  - 잘못된 메시지 형식 처리 테스트
  - _요구사항: 1.2, 2.1, 2.4_

- [x] 7. 퀴즈 답변 제출 API 테스트 구현





  - 객관식 퀴즈 정답 제출 테스트
  - 객관식 퀴즈 오답 제출 테스트
  - 주관식 퀴즈 답변 제출 테스트
  - 퀴즈 없이 답변 제출 테스트
  - _요구사항: 1.3, 2.1, 2.4_

- [x] 7.1. 주관식 퀴즈 답변 제출 테스트 (5챕터 1섹션)



  - 5챕터 1섹션 세션 시작 및 주관식 퀴즈 출제까지 진행
  - 주관식 퀴즈 정답 제출 및 평가 검증
  - 주관식 퀴즈 부분 정답 제출 및 피드백 검증
  - 주관식 퀴즈 오답 제출 및 재학습 권장 검증
  - _요구사항: 1.3, 2.1, 2.4_

- [x] 7.2. 실제 LLM 호출을 통한 주관식 퀴즈 평가 테스트 (5챕터 1섹션)









  - 5챕터 1섹션 세션 시작부터 주관식 퀴즈 출제까지 완전한 플로우 실행
  - 실제 주관식 답변 제출 시 evaluation_feedback_agent까지 호출되는지 검증
  - LLM을 통한 실제 평가 및 피드백 생성 과정 테스트
  - 워크플로우 오류 없이 전체 평가 단계까지 도달하는지 확인
  - 생성된 피드백 내용의 품질 및 형식 기본 검증
  - _요구사항: 1.3, 2.1, 2.4_

- [x] 7.3. State 검증기의 퀴즈 타입별 필드 검증 로직 수정


  - 객관식 퀴즈 생성 시 주관식 필드(subjective_answer_score 등)가 비어있어도 오류가 발생하지 않도록 수정
  - 주관식 퀴즈 생성 시 객관식 필드(quiz_options, quiz_correct_answer)가 비어있어도 오류가 발생하지 않도록 수정
  - validate_quiz_consistency 메서드의 검증 로직을 퀴즈 생성 상태를 고려하여 개선
  - Invalid TutorState provided 오류 해결을 위한 필드 검증 완화
  - _요구사항: 1.3, 2.1, 2.4_

- [x] 7.4. 5챕터 1섹션 주관식 퀴즈 생성 무한 루프 문제 해결




  - 5챕터 1섹션에서 주관식 퀴즈 요청 시 계속 객관식 퀴즈가 생성되는 문제 분석
  - 퀴즈 생성 도구(quiz_tools_chatgpt.py)의 프롬프트 및 응답 파싱 로직 검토
  - 5챕터 1섹션 콘텐츠 데이터에서 퀴즈 타입 설정 확인
  - 주관식 퀴즈 생성이 정상적으로 작동하도록 수정
  - _요구사항: 1.3, 2.1, 2.4_

- [ ] 8. 세션 완료 API 테스트 구현
  - "proceed" 결정으로 세션 완료 테스트
  - "retry" 결정으로 세션 완료 테스트
  - 완료 불가능한 상태에서 세션 완료 테스트
  - 잘못된 결정값으로 세션 완료 테스트
  - _요구사항: 1.4, 2.1, 2.4_

- [ ] 9. 데이터베이스 저장 검증 테스트 구현
  - learning_sessions 테이블 데이터 저장 검증
  - session_conversations 테이블 데이터 저장 검증
  - session_quizzes 테이블 데이터 저장 검증
  - user_statistics 테이블 업데이트 검증
  - _요구사항: 3.1, 3.2, 3.3, 3.4_

- [ ] 10. 전체 학습 플로우 통합 테스트 구현
  - 세션 시작 → 이론 설명 → 퀴즈 → 평가 → 세션 완료 전체 플로우 테스트
  - 재학습 플로우 (retry 결정) 테스트
  - proceed 결정 후 다음 섹션/챕터 학습 연속 테스트
  - 질문-답변 플로우 포함 테스트
  - 실제 LLM 응답 품질 기본 검증
  - _요구사항: 1.1, 1.2, 1.3, 1.4_

- [ ] 11. 메모리 세션 관리 테스트 구현
  - 세션 시작 후 메모리 상태 생성 검증
  - 세션 진행 중 상태 유지 검증
  - 세션 완료 후 메모리 정리 검증
  - 세션 만료 시간 초과 시 자동 정리 검증
  - _요구사항: 4.1, 4.2, 4.3, 4.4_

- [ ] 12. 테스트 데이터 정리 유틸리티 구현
  - 수동 삭제를 위한 CLI 스크립트 생성
  - 테스트 데이터 요약 조회 스크립트
  - CASCADE 삭제를 활용한 안전한 데이터 정리
  - 삭제 결과 로깅 및 확인 기능
  - _요구사항: 3.5_