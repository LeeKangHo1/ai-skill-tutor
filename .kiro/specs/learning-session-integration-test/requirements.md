# 학습 세션 통합 테스트 요구사항 문서

## 소개

백엔드에서 구현된 학습 API 엔드포인트들(세션 시작, 메시지 전송, 퀴즈 제출, 세션 완료)이 전체 학습 플로우에서 올바르게 동작하는지 검증하는 통합 테스트를 구현합니다. 이 테스트는 MVP 완성을 위한 핵심 기능 검증에 중점을 둡니다.

## 요구사항

### 요구사항 1

**사용자 스토리:** 개발자로서, 학습 세션의 전체 플로우가 올바르게 동작하는지 자동화된 테스트를 통해 검증하고 싶습니다.

#### 승인 기준

1. WHEN 학습 세션을 시작하면 THEN 시스템은 TutorState를 초기화하고 이론 설명을 반환해야 합니다
2. WHEN 이론 설명 후 사용자가 메시지를 전송하면 THEN 시스템은 적절한 에이전트로 라우팅하여 응답해야 합니다
3. WHEN 퀴즈가 출제되고 답변을 제출하면 THEN 시스템은 평가 결과와 피드백을 제공해야 합니다
4. WHEN 세션을 완료하면 THEN 시스템은 학습 기록을 데이터베이스에 저장하고 진행 상태를 업데이트해야 합니다

### 요구사항 2

**사용자 스토리:** 개발자로서, 다양한 학습 시나리오에서 API 엔드포인트들이 안정적으로 동작하는지 확인하고 싶습니다.

#### 승인 기준

1. WHEN 올바른 JWT 토큰으로 API를 호출하면 THEN 시스템은 정상적으로 응답해야 합니다
2. WHEN 잘못된 토큰이나 권한으로 API를 호출하면 THEN 시스템은 적절한 오류 메시지를 반환해야 합니다
3. WHEN 사용자가 접근 권한이 없는 챕터에 접근하려 하면 THEN 시스템은 접근을 거부해야 합니다
4. WHEN 세션 상태가 없는 상황에서 메시지를 전송하면 THEN 시스템은 적절히 처리해야 합니다

### 요구사항 3

**사용자 스토리:** 개발자로서, 데이터베이스 연동이 올바르게 작동하는지 검증하고 싶습니다.

#### 승인 기준

1. WHEN 세션을 완료하면 THEN 학습 기록이 learning_sessions 테이블에 저장되어야 합니다
2. WHEN 세션을 완료하면 THEN 대화 기록이 session_conversations 테이블에 저장되어야 합니다
3. WHEN 퀴즈 답변을 제출하면 THEN 퀴즈 정보가 session_quizzes 테이블에 저장되어야 합니다
4. WHEN 세션을 완료하면 THEN user_statistics 테이블이 학습 통계를 반영하여 업데이트되어야 합니다
5. WHEN 데이터베이스 저장 중 오류가 발생하면 THEN 시스템은 트랜잭션을 롤백하고 오류를 반환해야 합니다

### 요구사항 4

**사용자 스토리:** 개발자로서, 메모리 기반 세션 관리가 올바르게 동작하는지 확인하고 싶습니다.

#### 승인 기준

1. WHEN 새로운 세션을 시작하면 THEN TutorState가 메모리에 생성되어야 합니다
2. WHEN 세션 중 메시지를 주고받으면 THEN State가 지속적으로 유지되어야 합니다
3. WHEN 세션을 완료하면 THEN 메모리에서 State가 정리되어야 합니다
4. WHEN 비활성 세션이 1시간을 초과하면 THEN State가 자동으로 만료되어야 합니다