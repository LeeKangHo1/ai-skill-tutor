# 개선이 필요한 부분

## 추가 개발이 필요한 미해결 이슈들

### quiz 생성에서 벡터 db 내용 활용하지 않음

### 1. 세션 횟수 영속성 문제

**문제**: `current_session_count`가 데이터베이스에 저장되지 않음
- `current_session_count` 필드가 TutorState(메모리)에만 존재
- SessionService가 세션 완료 후 사용자 상태를 지우면 카운트가 0으로 초기화됨
- 사용자가 새 세션을 시작하여 세션 제한(섹션당 최대 1회 재학습)을 우회할 수 있음

**영향**:
- 세션 재시도 제한 적용이 무효화됨
- 사용자가 적절한 추적 없이 동일한 섹션을 반복적으로 재시도할 수 있음
- 세션 통계가 부정확해짐

**필요한 해결책**:
- `user_progress` 테이블에 `current_session_count` 컬럼 추가
- SessionManager가 세션 카운트를 데이터베이스에 저장하도록 업데이트
- SessionService가 세션 시작 시 데이터베이스에서 세션 카운트를 로드하도록 수정

---

### 2. 세션 요약 연속성 문제

**문제**: `recent_sessions_summary`가 세션 간에 보존되지 않음
- 세션 요약이 TutorState 메모리에만 저장됨
- SessionService가 세션 완료 후 `self._clear_user_state()`를 호출하여 모든 요약 손실
- 다음 세션이 이전 세션 기록에 대한 정보 없이 시작됨

**영향**:
- 세션 간 연속성 손실
- QnA 에이전트가 이전 학습 맥락을 참조할 수 없음
- 사용자가 최근 학습 진행 상황을 추적하지 못함

**필요한 해결책**:
- `user_session_summaries` 데이터베이스 테이블 생성
- 최근 5개 세션 요약을 데이터베이스에 저장
- 새 세션 상태 초기화 시 최근 요약 로드
- 대안: `user_progress` 테이블에 요약용 JSON 컬럼 추가

---

### 3. State 관리 아키텍처 격차

**근본 원인**: Stateful LangGraph 워크플로우와 Stateless 세션 관리 간의 불일치
- LangGraph 워크플로우는 상호작용 간 지속적인 상태를 기대
- SessionService는 메모리 정리와 함께 상태 없는 접근 방식을 구현
- 데이터베이스 스키마가 모든 상태 지속성 요구사항을 지원하지 않음

**권장 아키텍처 검토**:
- 하이브리드 접근법 평가: 중요한 상태 필드를 데이터베이스에 저장
- 복잡한 워크플로우 연속성을 위한 세션 상태 직렬화 고려
- 각 세션 후 완전한 상태 정리가 필요한지 검토

---

*최종 업데이트: 2025-08-23*  
*우선순위: 높음 - 이러한 문제들은 핵심 기능과 사용자 경험에 영향을 미침*